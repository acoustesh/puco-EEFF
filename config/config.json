{
  "_description": "Shared project configuration for puco-EEFF. XBRL-specific config is in xbrl_specs.json.",

  "period_types": {
    "quarterly": {
      "key_format": "{year}_Q{period}",
      "display_format": "{roman}Q{year}",
      "periods_per_year": 4,
      "roman_numerals": {"1": "I", "2": "II", "3": "III", "4": "IV"}
    },
    "monthly": {
      "key_format": "{year}_M{period:02d}",
      "display_format": "{period:02d}-{year}",
      "periods_per_year": 12
    },
    "yearly": {
      "key_format": "{year}_FY",
      "display_format": "FY{year}",
      "periods_per_year": 1
    }
  },

  "file_patterns": {
    "analisis_razonado": {
      "pattern": "analisis_razonado_{year}_Q{quarter}.pdf",
      "description": "Management Discussion and Analysis (MD&A)"
    },
    "estados_financieros_pdf": {
      "pattern": "estados_financieros_{year}_Q{quarter}.pdf",
      "description": "Financial Statements PDF"
    },
    "estados_financieros_xbrl": {
      "pattern": "estados_financieros_{year}_Q{quarter}.xbrl",
      "alt_patterns": ["estados_financieros_{year}_Q{quarter}.xml"],
      "description": "Financial Statements XBRL/XML"
    },
    "xbrl_zip": {
      "pattern": "estados_financieros_{year}_Q{quarter}_xbrl.zip",
      "description": "XBRL package download"
    },
    "pucobre_combined": {
      "pattern": "pucobre_combined_{year}_Q{quarter}.pdf",
      "description": "Combined PDF from pucobre.cl fallback source"
    }
  },

  "sources": {
    "cmf_chile": {
      "name": "CMF Chile - Pucobre EEFF",
      "base_url": "https://www.cmfchile.cl/institucional/mercados/entidad.php?mercado=V&rut=96561560&grupo=&tipoentidad=RVEMI&row=&vig=VI&control=svs&pestania=3",
      "description": "Portal de información financiera CMF Chile - All downloads from single source",
      "entity": {
        "name": "Sociedad Punta del Cobre S.A.",
        "rut": "96561560"
      },
      "filters": {
        "selectors": {
          "month": "select[name='mm']",
          "year": "select[name='aa']",
          "tipo": "select[name='tipo']",
          "tipo_norma": "select[name='tipo_norma']",
          "submit": "input[value='Consultar']"
        },
        "default_values": {
          "tipo": "C",
          "tipo_norma": "IFRS",
          "_tipo_options": {
            "C": "Consolidado",
            "I": "Individual"
          },
          "_tipo_norma_options": {
            "IFRS": "Estándar IFRS",
            "NCH": "Norma Chilena"
          }
        },
        "month_to_quarter": {
          "03": 1,
          "06": 2,
          "09": 3,
          "12": 4
        },
        "quarter_to_month": {
          "1": "03",
          "2": "06",
          "3": "09",
          "4": "12"
        }
      },
      "downloads": {
        "analisis_razonado": {
          "link_text": "Análisis Razonado",
          "filename_pattern": "analisis_razonado_{year}_Q{quarter}.pdf",
          "description": "Management Discussion and Analysis (MD&A)"
        },
        "estados_financieros_pdf": {
          "link_text": "Estados financieros (PDF)",
          "filename_pattern": "estados_financieros_{year}_Q{quarter}.pdf",
          "description": "Financial Statements PDF"
        },
        "estados_financieros_xbrl": {
          "link_text": "Estados financieros (XBRL)",
          "filename_pattern": "estados_financieros_{year}_Q{quarter}_xbrl.zip",
          "description": "Financial Statements XBRL/XML package"
        }
      }
    },
    "pucobre": {
      "name": "Pucobre.cl - Estados Financieros",
      "base_url": "https://www.pucobre.cl/OpenDocs/asp/pagDefault.asp?boton=Doc51&argInstanciaId=51&argCarpetaId=32&argTreeNodosAbiertos=(32)&argTreeNodoActual=32&argTreeNodoSel=32",
      "description": "Fallback source - Pucobre company website. Only has PDF Estados Financieros (no XBRL, no Análisis Razonado).",
      "entity": {
        "name": "Sociedad Punta del Cobre S.A.",
        "website": "https://www.pucobre.cl"
      },
      "link_pattern": "Estados Financieros {date}",
      "date_format": "DD-MM-YYYY",
      "quarter_to_date": {
        "1": "31-03",
        "2": "30-06",
        "3": "30-09",
        "4": "31-12"
      },
      "downloads": {
        "estados_financieros_pdf": {
          "filename_pattern": "estados_financieros_{year}_Q{quarter}.pdf",
          "description": "Financial Statements PDF (same content as CMF)"
        }
      },
      "notes": [
        "Use as fallback when CMF Chile doesn't have the data",
        "Q1 data is typically available here before CMF publishes Q2",
        "Only provides PDF - no XBRL or Análisis Razonado"
      ]
    }
  },

  "sheets": {
    "sheet1": {
      "name": "Ingresos y Costos",
      "description": "Revenue and detailed cost breakdown from Estados Financieros - Nota 21 & 22",
      "layout": {
        "columns": "One column per quarter, from Q1 2024 onwards",
        "header_row": "Quarter label (e.g., 'IQ2024', 'IIQ2024', 'IIIQ2024', 'IVQ2024')",
        "total_rows": 27,
        "sections": [
          {
            "name": "Ingresos",
            "rows": [1],
            "items": ["Ingresos de actividades ordinarias M USD"]
          },
          {
            "name": "Costo de Venta",
            "rows": [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],
            "header_row": 2,
            "items": [
              "Gastos en personal",
              "Materiales y repuestos",
              "Energía eléctrica",
              "Servicios de terceros",
              "Depreciación y amort del periodo",
              "Depreciación Activos en leasing -Nota 20",
              "Depreciación Arrendamientos -Nota 20",
              "Servicios mineros de terceros",
              "Fletes y otros gastos operacionales",
              "Gastos Diferidos, ajustes existencias y otros",
              "Obligaciones por convenios colectivos",
              "Total Costo de Venta"
            ],
            "total_row": 14,
            "total_label": "Total Costo de Venta"
          },
          {
            "name": "Gasto Adm. y Ventas",
            "rows": [18, 19, 20, 21, 22, 23, 24],
            "header_row": 17,
            "items": [
              "Gastos en personal",
              "Materiales y repuestos",
              "Servicios de terceros",
              "Provision gratificacion legal y otros",
              "Gastos comercializacion",
              "Otros gastos",
              "Totales"
            ],
            "total_row": 24,
            "total_label": "Totales",
            "_disambiguation": "This 'Totales' refers specifically to Gasto Adm. y Ventas total (row 24/27), NOT Costo de Venta total"
          }
        ]
      },
      "row_mapping": {
        "1": {"field": "ingresos_ordinarios", "label": "Ingresos de actividades ordinarias M USD", "section": null},
        "2": {"field": null, "label": "", "section": null},
        "3": {"field": "costo_venta_header", "label": "Costo de Venta", "section": "header"},
        "4": {"field": "cv_gastos_personal", "label": "Gastos en personal", "section": "costo_venta"},
        "5": {"field": "cv_materiales", "label": "Materiales y repuestos", "section": "costo_venta"},
        "6": {"field": "cv_energia", "label": "Energía eléctrica", "section": "costo_venta"},
        "7": {"field": "cv_servicios_terceros", "label": "Servicios de terceros", "section": "costo_venta"},
        "8": {"field": "cv_depreciacion_amort", "label": "Depreciación y amort del periodo", "section": "costo_venta"},
        "9": {"field": "cv_deprec_leasing", "label": "Depreciación Activos en leasing -Nota 20", "section": "costo_venta"},
        "10": {"field": "cv_deprec_arrend", "label": "Depreciación Arrendamientos -Nota 20", "section": "costo_venta"},
        "11": {"field": "cv_serv_mineros", "label": "Servicios mineros de terceros", "section": "costo_venta"},
        "12": {"field": "cv_fletes", "label": "Fletes y otros gastos operacionales", "section": "costo_venta"},
        "13": {"field": "cv_gastos_diferidos", "label": "Gastos Diferidos, ajustes existencias y otros", "section": "costo_venta"},
        "14": {"field": "cv_convenios", "label": "Obligaciones por convenios colectivos", "section": "costo_venta"},
        "15": {"field": "total_costo_venta", "label": "Total Costo de Venta", "section": "costo_venta_total"},
        "16": {"field": null, "label": "", "section": null},
        "17": {"field": null, "label": "", "section": null},
        "18": {"field": null, "label": "", "section": null},
        "19": {"field": "gasto_admin_header", "label": "Gasto Adm, y Ventas", "section": "header"},
        "20": {"field": "ga_gastos_personal", "label": "Gastos en personal", "section": "gasto_admin"},
        "21": {"field": "ga_materiales", "label": "Materiales y repuestos", "section": "gasto_admin"},
        "22": {"field": "ga_servicios_terceros", "label": "Servicios de terceros", "section": "gasto_admin"},
        "23": {"field": "ga_gratificacion", "label": "Provision gratificacion legal y otros", "section": "gasto_admin"},
        "24": {"field": "ga_comercializacion", "label": "Gastos comercializacion", "section": "gasto_admin"},
        "25": {"field": "ga_otros", "label": "Otros gastos", "section": "gasto_admin"},
        "26": {"field": null, "label": "", "section": null},
        "27": {"field": "total_gasto_admin", "label": "Totales", "section": "gasto_admin_total", "_note": "This is the ONLY 'Totales' that should be in row 27"}
      }
    },
    "sheet2": {
      "name": "TBD - Estado de Resultados",
      "description": "Income Statement / Statement of Profit or Loss"
    },
    "sheet3": {
      "name": "TBD - Estado de Flujos de Efectivo",
      "description": "Cash Flow Statement"
    },
    "sheet4": {
      "name": "TBD - Notas",
      "description": "Notes to Financial Statements"
    }
  },


  "ocr": {
    "primary": {
      "provider": "mistral",
      "model": "mistral-ocr-latest"
    },
    "fallback": [
      {"provider": "openrouter", "model": "anthropic/claude-3.5-sonnet", "description": "Anthropic Claude via OpenRouter"},
      {"provider": "openrouter", "model": "openai/gpt-4o", "description": "OpenAI GPT-4o via OpenRouter"}
    ],
    "retry": {
      "max_attempts": 3,
      "strategy": "exponential",
      "base_delay_seconds": 1,
      "max_delay_seconds": 30
    },
    "save_all_responses": true
  },

  "output": {
    "filename_pattern": "EEFF_{year}_Q{quarter}.xlsx",
    "date_format": "YYYY_QN"
  },

  "logging": {
    "format": "simple",
    "filename_pattern": "{date}_run.log"
  },

  "temp_files": {
    "directory": "temp",
    "auto_cleanup": true,
    "page_extraction_prefix": "page_review_"
  }
}
